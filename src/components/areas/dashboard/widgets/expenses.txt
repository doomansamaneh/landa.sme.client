<template>
  <q-card class="fit">
    <q-card-section class="q-pt-lg q-px-lg q-pb-none">
      <div class="row justify-between items-center">
        <div>
          <q-item class="no-padding">
            <q-item-section avatar>
              <q-avatar
                rounded
                text-color="white"
                icon="o_receipt_long"
                size="md"
                class="primary-gradient primary-shadow"
              />
            </q-item-section>
            <q-item-section>
              <q-item-label class="text-h6 text-weight-700">
                هزینه
              </q-item-label>
            </q-item-section>
          </q-item>
        </div>

        <div class="col-5">
          <q-select outlined dense></q-select>
        </div>
      </div>
    </q-card-section>

    <q-card-section class="q-pt-md q-px-lg">
      <h2 class="text-body1">هزینه های 30 روز پیش</h2>
      <h1 class="text-h3 text-weight-700">200 میلیون ریال</h1>
      <div class="row">
        <q-icon color="green-8" size="20px" name="arrow_downward" />
        <h2 class="text-body1 q-mb-md">
          <span class="text-weight-500 text-green-8">50% کاهش</span>
          نسبت 30 روز پیش
        </h2>
      </div>
      <div style="width: 250px">
        <ApexChart
          type="donut"
          :options="chartOptions"
          :series="chartData"
          @click="handleChartClick"
        />
      </div>
    </q-card-section>

    <mini-widget />
  </q-card>
</template>

<script>
  import { defineComponent, computed } from "vue";
  import ApexChart from "vue3-apexcharts";
  import MiniWidget from "src/components/areas/cmn/product/desktop/widgets/miniWidget/IndexView.vue";
  export default defineComponent({
    components: {
      ApexChart,
      MiniWidget,
    },
    data() {
      return {
        chartData: [440, 550, 130], // Example data
        chartOptions: {
          plotOptions: {
            pie: {
              donut: {
                size: "40%",
              },
            },
          },
          chart: {
            type: "donut",
            offsetX: 40,
          },
          labels: [
            "هزینه کسری کالا",
            "هزینه های بازاریابی و پورسانت",
            "هزینه کارمزد وام ها و خدمات بانکی",
          ],
          legend: {
            show: false, // Hide the default legend
          },
        },
        chartColors: ["#FF4560", "#008FFB", "#00E396"], // Colors for chart segments
      };
    },
    computed: {
      truncatedLabels() {
        return this.chartOptions.labels.map((label) => {
          return label.length > 10
            ? label.slice(0, 10) + "..."
            : label; // Truncate long labels
        });
      },
    },
    methods: {
      handleChartClick(event, chartContext, config) {
        const clickedIndex = config.dataPointIndex;
        if (clickedIndex !== undefined) {
          alert(
            `You clicked on: ${this.chartOptions.labels[clickedIndex]}`
          );
        }
      },
    },
  });
</script>
